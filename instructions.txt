git clone https://github.com/igrr/mkspiffs.git
cd mkspiffs
git submodule update --init
make dist BUILD_CONFIG_NAME="-esp-idf" CPPFLAGS="-DSPIFFS_OBJ_META_LEN=4"

mkdir file && cd file
../mkspiffs -c . -b <BLOCK_SIZE> -p <PAGE_SIZE> -s <PARTITION_SIZE> <BINARY>.bin

cp <BINARY>.bin <PROJECT_DIRECTORY>

cd <PROJECT_DIRECTORY>

<ESP_TOOL> write_flash -z <PARTITION_OFFSET> <BINARY>.bin
<ESP_TOOL> --chip esp32 --port <PORT> --baud <BAUD> write_flash -z <PARTITION_OFFSET> <BINARY>.bin

make menuconfig (Serial flash config -> Flash size -> 4MB; Partition Table -> Custom Partition Table)

make flash
make monitor

PROJECT_DIRECTORY = /home/gabrielbvicari/esp/spiffs/
BLOCK_SIZE = 4096
PAGE_SIZE = 256
PARTITION_SIZE = 0x2F0000
PARTITION_OFFSET = 0x110000
BINARY = spiffs
PORT = /dev/ttyUSB0
BAUD = 115200
ESP_TOOL = python /home/gabrielbvicari/esp/esp-idf/components/esptool_py/esptool/esptool.py
